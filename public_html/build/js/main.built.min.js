var loadAssets=function(){game.load.image("hitBox","assets/sprites/transTest.png"),game.load.image("logo","assets/gui/logo.png"),game.load.image("won","assets/gui/won.png"),game.load.image("died","assets/gui/died.png"),game.load.spritesheet("startOptions","assets/gui/startOptions_spritesheet.png",500,80),game.load.spritesheet("retryOptions","assets/gui/retryOptions_spritesheet.png",780,80),game.load.spritesheet("return","assets/gui/return_spritesheet.png",620,80),game.load.spritesheet("heart","assets/gui/heart_spritesheet.png",40,40),game.load.spritesheet("button_a","assets/controls/button_a.png",150,150),game.load.spritesheet("button_left","assets/controls/button_left.png",150,150),game.load.spritesheet("button_right","assets/controls/button_right.png",150,150),game.load.spritesheet("shroomLord","assets/sprites/shroomLord_spritesheet.png",360,320),game.load.image("shroom1","assets/sprites/entity_shroom_red.png"),game.load.image("shroom2","assets/sprites/entity_shroom_tan.png"),game.load.spritesheet("bomb","assets/sprites/entity_bomb_spritesheet.png",60,60),game.load.spritesheet("explosion","assets/sprites/explosion_spritesheet.png",200,200),game.load.image("bg_dawn","assets/bg/bg_dawn.png"),game.load.image("bg_night","assets/bg/bg_night.png"),game.load.image("bg_inside","assets/bg/bg_inside.png"),game.load.image("bg_outside","assets/bg/bg_outside.png"),game.load.spritesheet("bed","assets/sprites/bed_spritesheet.png",190,130),game.load.spritesheet("sign","assets/sprites/sign.png",150,100),game.load.image("ground","assets/sprites/ground.png"),game.load.image("shroomPlatformRed","assets/sprites/platform_red.png"),game.load.image("shroomPlatformTan","assets/sprites/platform_tan.png"),game.load.image("shroomPlatformRedSmall","assets/sprites/platform_red_small.png"),game.load.image("shroomPlatformTanSmall","assets/sprites/platform_tan_small.png"),game.load.spritesheet("player","assets/sprites/player_spritesheet.png",70,100),game.load.image("gib_head","assets/sprites/player_gibs/player_gib_head.png"),game.load.image("gib_body","assets/sprites/player_gibs/player_gib_body.png"),game.load.image("gib_hat","assets/sprites/player_gibs/player_gib_hat.png"),game.load.image("gib_limb","assets/sprites/player_gibs/player_gib_limb.png"),game.load.audio("music",["assets/audio/twilight_juggle.mp3","assets/audio/twilight_juggle.ogg"]),game.load.audio("sfx_explosion",["assets/audio/explosion.mp3","assets/audio/explosion.ogg"]),game.load.audio("sfx_jump",["assets/audio/jump.mp3","assets/audio/jump.ogg"])};SectionManager=function(sections,singleInstance){for(this.sections={},this.singleInstance="undefined"!=typeof singleinstance?singleInstance:!0,i=0;i<sections.length;i++)this.add(sections[i])},SectionManager.prototype={add:function(name){var section={running:!1,initialised:!1};this.sections[name]=section},remove:function(name){delete this.sections[name]},isRunning:function(section){return this.sections[section].running?!0:!1},isInitialised:function(section){return this.sections[section].initialised?!0:!1},currentSection:function(){if(this.singleInstance)for(var index in this.sections)if(this.sections.hasOwnProperty(index)&&this.sections[index].running)return index},init:function(section){this.sections[section].initialised=!0},start:function(section){if(this.singleInstance)for(var index in this.sections)this.sections.hasOwnProperty(index)&&(this.sections[index].running=!1);this.sections[section].running=!0},stop:function(section){this.sections[section].running=!1},reset:function(section){this.sections[section].running=!1,this.sections[section].initialised=!1},resetAll:function(){for(var index in this.sections)this.sections.hasOwnProperty(index)&&(this.sections[index].running=!1,this.sections[index].initialised=!1)}},Background=function(game){this.game=game,this.sky={},this.bg={}},Background.prototype={create:function(){this.makeSky(),this.makeBackground()},update:function(){this.sky.night.alpha=game.camera.y/game.world.height+.1,this.bg.outside.tilePosition.y=.2*game.camera.y},makeSky:function(){this.sky.dawn=this.game.add.sprite(0,0,"bg_dawn"),this.sky.dawn.width=game.camera.width,this.sky.dawn.height=game.camera.height,this.sky.dawn.fixedToCamera=!0,this.sky.night=this.game.add.sprite(0,0,"bg_night"),this.sky.night.width=game.camera.width,this.sky.night.height=game.camera.height,this.sky.night.fixedToCamera=!0},makeBackground:function(){this.bg.outside=this.game.add.tileSprite(0,0,game.world.width,game.world.height,"bg_outside"),this.bg.outside.alpha=.5,this.bg.inside=this.game.add.tileSprite(0,0,game.world.width,game.world.height,"bg_inside"),this.bg.inside.alpha=.8},scroll:function(){this.bg.outside.tilePosition.y++,this.bg.inside.tilePosition.y+=2},fadeLoop:function(){this.bgFade=game.add.tween(this.sky.night).to({alpha:0},5e3,Phaser.Easing.Linear.None).delay(2500).to({alpha:1},5e3,Phaser.Easing.Linear.None).loop().start()}},Player=function(game,health){this.game=game,this.sprite={heart:1},this.gibs=null,this.heart="undefined"!=typeof health?health:1,this.movement={targetSpeed:400,acceleration:0},this.alive=!0},Player.prototype={create:function(){this.sprite=game.add.sprite(600,game.world.height-150,"player"),this.sprite.heart=this.heart,this.sprite.anchor.setTo(.5,.5),game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.gravity.y=1800,this.sprite.body.setSize(40,100,0,0),this.sprite.body.collideWorldBounds=!0,this.sprite.body.tilePadding.setTo(10,10),this.sprite.animations.add("walkRight",[5,6,7,8,9,10],16,!0),this.sprite.animations.add("walkLeft",[11,12,13,14,15,16],16,!0),this.sprite.animations.add("jumpRight",[1,2],8,!0),this.sprite.animations.add("jumpLeft",[3,4],8,!0),this.sprite.animations.add("hurt",[3,4],1,!0),this.sfx_jump=this.game.add.audio("sfx_jump",.2,!1),this.gibs=game.add.group()},jump:function(){this.sprite.body.wasTouching.down&&(this.sprite.body.velocity.y=-850,this.sfx_jump.play())},move:function(direction){this.movement.acceleration=this.sprite.body.wasTouching.down?.3:.1,"right"==direction?(this.sprite.animations.play(this.sprite.body.wasTouching.down?"walkRight":"jumpRight"),this.sprite.body.velocity.x<0&&(this.sprite.body.velocity.x=0*this.movement.acceleration+(1-this.movement.acceleration)*this.sprite.body.velocity.x),this.sprite.body.velocity.x+=this.movement.acceleration*this.movement.targetSpeed+(1-this.movement.acceleration)*Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.x)):"left"==direction&&(this.sprite.animations.play(this.sprite.body.wasTouching.down?"walkLeft":"jumpLeft"),this.sprite.body.velocity.x>0&&(this.sprite.body.velocity.x=0*this.movement.acceleration+(1-this.movement.acceleration)*this.sprite.body.velocity.x),this.sprite.body.velocity.x-=this.movement.acceleration*this.movement.targetSpeed+(1-this.movement.acceleration)*Math.abs(this.sprite.body.velocity.x)-Math.abs(this.sprite.body.velocity.x))},halt:function(){this.sprite.animations.stop(),this.sprite.frame=0,this.sprite.body.velocity.x=0*this.movement.acceleration+(1-this.movement.acceleration)*this.sprite.body.velocity.x},fallDamage:function(player,platform){this.sprite.body.velocity.y>1100&&platform.fallDamage&&(this.sprite.heart=0)},hurt:function(){this.sprite.heart--},platformCollision:function(){return this.sprite.body.velocity.y<0?!1:!0},death:function(){if(this.alive)for(this.alive=!1,this.sprite.kill(),i=0;7>i;i++){switch(this.gib=null,i){case 0:this.gib=this.gibs.create(this.sprite.x,this.sprite.y,"gib_head");break;case 1:this.gib=this.gibs.create(this.sprite.x,this.sprite.y,"gib_body");break;case 2:this.gib=this.gibs.create(this.sprite.x,this.sprite.y,"gib_hat");break;default:this.gib=this.gibs.create(this.sprite.x,this.sprite.y,"gib_limb")}this.gib.anchor.setTo(.5,.5),game.physics.enable(this.gib,Phaser.Physics.ARCADE),this.gib.body.gravity.y=600,this.gib.body.velocity.setTo(200*Math.random()-100,-1e3*Math.random()),this.gib.body.rotation=360*Math.random(),this.gib.body.bounce.y=.5,this.gib.body.bounce.x=.5,this.gib.body.linearDamping=50,this.gib.body.collideWorldBounds=!0}},render:function(){game.debug.bodyInfo(this.sprite,32,32),game.debug.body(this.sprite)}},Platforms=function(game){this.game=game,this.group=null},Platforms.prototype={create:function(){this.group=this.game.add.group(),this.generateLedges(0,game.world.height-200),this.generateLedges(game.world.width/12*5,game.world.height-300),this.ground=this.group.create(0,game.world.height-35,"ground"),this.ground.scale.setTo(15,1),game.physics.enable(this.ground,Phaser.Physics.ARCADE),this.ground.body.immovable=!0,this.ground.fallDamage=!0,this.bossPlatform=this.group.create(0,600,"ground"),this.bossPlatform.scale.setTo(15,1),game.physics.enable(this.bossPlatform,Phaser.Physics.ARCADE),this.bossPlatform.body.immovable=!0,this.bossPlatform.fallDamage=!1},generateLedges:function(startX,startY){this.previousY=startY;for(var i=0;this.previousY>700;)i>1?this.makeLedge(Math.random()*(game.world.width/12)*4+startX,this.previousY,"random",!0,!0):this.makeLedge(Math.random()*(game.world.width/12)*4+startX,this.previousY,"random",!1,!1),this.previousY-=180,i++},generateBossArena:function(){this.makeLedge(0,400,"shroomPlatformTanSmall"),this.makeLedge(game.world.width-150,400,"shroomPlatformRedSmall")},makeLedge:function(x,y,type,fragile,fallDamage){type="undefined"!=typeof type?type:"random",fragile="undefined"!=typeof fragile?fragile:!1,fallDamage="undefined"!=typeof fallDamage?fallDamage:!1,this.random=Math.random(),this.ledge=null,this.ledge="random"==type?this.random<=.25?this.group.create(x,y,"shroomPlatformRed"):this.random>.25&&this.random<=.5?this.group.create(x,y,"shroomPlatformTan"):this.random>.5&&this.random<=.75?this.group.create(x,y,"shroomPlatformTanSmall"):this.group.create(x,y,"shroomPlatformRedSmall"):this.group.create(x,y,type),game.physics.enable(this.ledge,Phaser.Physics.ARCADE),this.ledge.body.immovable=!0,this.ledge.body.checkCollision.left=!1,this.ledge.body.checkCollision.right=!1,this.ledge.body.checkCollision.bottom=!1,this.ledge.body.moves=!1,fragile?(this.ledge.fragile=!0,this.ledge.heart=hardMode?60:120):this.ledge.fragile=!1,this.ledge.fallDamage=fallDamage},removalCheck:function(){var check=function(entity){entity.y>this.game.camera.y+this.game.camera.height+100&&entity.fragile&&entity.kill()};hardMode&&this.group.forEachAlive(check,this)},age:function(player,platform){if(platform.heart--,platform.alpha=platform.heart/60,platform.heart<=0){var revive=function(){platform.revive(1),platform.heart=hardMode?60:120,platform.alpha=1};this.game.time.events.add(4*Phaser.Timer.SECOND,revive),platform.kill()}}},Bombs=function(game){this.game=game,this.group=null,this.explosions=null},Bombs.prototype={create:function(){this.group=game.add.group(),this.explosions=game.add.group(),this.sfx_explosion=this.game.add.audio("sfx_explosion",.2,!1)},spawn:function(x,y,velY_Offset){velY_Offset="undefined"!=typeof velY_Offset?velY_Offset:0,this.group.countDead()>0?(this.entity=this.group.getFirstDead(),this.entity.reset(x,y,1)):(this.entity=this.group.create(x,y,"bomb"),this.entity.anchor.setTo(.5,.5),game.physics.enable(this.entity,Phaser.Physics.ARCADE),this.entity.body.gravity.y=600,this.entity.body.bounce.x=.7+.2*Math.random(),this.entity.body.bounce.y=.2+.2*Math.random(),this.entity.body.collideWorldBounds=!0);this.entity.animations.add("countdown",[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1],20,!1);this.entity.animations.play("countdown"),this.entity.body.velocity.x=500*Math.random()-250,this.entity.body.velocity.y=800*Math.random()-400+velY_Offset,this.game.time.events.add(1.5*Phaser.Timer.SECOND,this.explode,this,this.entity)},spawnExplosion:function(x,y){this.explosions.countDead()>0?(this.entity=this.explosions.getFirstDead(),this.entity.reset(x,y,1)):(this.entity=this.explosions.create(x,y,"explosion"),this.entity.anchor.setTo(.5,.5),game.physics.enable(this.entity,Phaser.Physics.ARCADE),this.entity.body.setSize(160,160,0,0),this.entity.body.moves=!1,this.entity.animations.add("boom",[0,1,2,3,4,5,6,7,8,9])),this.entity.animations.play("boom",24,!1,!0),this.sfx_explosion.play()},explode:function(entity){this.spawnExplosion(entity.x,entity.y),entity.kill()},update:function(){this.group.forEachAlive(this.updateBomb,this)},updateBomb:function(entity){entity.angle=entity.body.x,entity.body.velocity.x=entity.body.velocity.x/1.002},removalCheck:function(){var check=function(entity){entity.y>this.game.camera.y+this.game.camera.height+100&&entity.kill()};this.group.forEachAlive(check,this)}},Shrooms=function(game){this.game=game,this.group=null},Shrooms.prototype={create:function(){this.group=game.add.group()},spawn:function(x,y){this.group.countDead()>0?(this.entity=this.group.getFirstDead(),this.entity.reset(x,y,1)):(this.entity=Math.random()<=.5?this.group.create(x,y,"shroom1"):this.group.create(x,y,"shroom2"),this.entity.anchor.setTo(.5,.5),game.physics.enable(this.entity,Phaser.Physics.ARCADE),this.entity.body.gravity.y=600,this.entity.body.bounce.x=.7,this.entity.body.bounce.y=.6,this.entity.body.collideWorldBounds=!0),this.entity.body.velocity.x=500*Math.random()-250},update:function(){this.group.forEachAlive(this.updateShroom,this)},updateShroom:function(entity){entity.body.wasTouching.down&&(entity.body.velocity.x=entity.body.velocity.x/1.5)},collect:function(player,shroom){shroom.kill(),score++},removalCheck:function(){var check=function(entity){entity.y>this.game.camera.y+this.game.camera.height+100&&entity.kill()};this.group.forEachAlive(check,this)}},Boss=function(game){this.game=game,this.sprite=null,this.speed=3e3,this.alive=!0},Boss.prototype={create:function(){this.sprite=this.game.add.sprite(100,440,"shroomLord"),this.sprite.anchor.setTo(.5,.5),game.physics.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.setSize(300,10,0,-90),this.sprite.body.immovable=!0,this.sprite.body.moves=!1,this.sprite.animations.add("walk",[2,3,4,5,6],8,!0),this.sprite.animations.add("hurt",[1],10,!1),this.sprite.heart=10,this.sprite.animations.play("walk"),this.sprite.body.immovable=!0,this.sprite.moveTween=game.add.tween(this.sprite).to({x:704},1500,Phaser.Easing.Quadratic.In).to(null,250,Phaser.Easing.Linear.None).to({x:280},1500,Phaser.Easing.Quadratic.In).to(null,250,Phaser.Easing.Linear.None).loop().start(),this.sprite.directionTween=game.add.tween(this.sprite).to(null,1500,Phaser.Easing.Linear.None).to({width:-360},250,Phaser.Easing.Linear.None).to(null,1500,Phaser.Easing.Linear.None).to({width:360},250,Phaser.Easing.Linear.None).loop().start(),this.sprite.killTween=game.add.tween(this.sprite).to({y:this.sprite.y-100},800,Phaser.Easing.Quadratic.Out).to({y:1200},1200,Phaser.Easing.Quadratic.In),this.sprite.hurtTween=game.add.tween(this.sprite).to({y:this.sprite.y-10},100,Phaser.Easing.Quadratic.Out).to({y:this.sprite.y},100,Phaser.Easing.Quadratic.Out)},update:function(){},playerBounce:function(player,boss){if(player.body.velocity.y<1){console.log("bounce"),player.body.velocity.y=-500,boss.animations.play("hurt",1,!1),boss.hurtTween.start(),boss.heart--;var resetAnim=function(){boss.animations.play("walk")};boss.heart>0&&game.time.events.add(.3*Phaser.Timer.SECOND,resetAnim)}},deathOutro:function(){1==this.alive&&(this.sprite.killTween.start(),this.sprite.directionTween.stop(),this.alive=!1)},collisionCheck:function(player,boss){return player.body.velocity.y<10||boss.heart<=0?!1:!0},render:function(){game.debug.text("Boss: "+this.sprite.heart,850,150)}},Timer=function(game,delay,func,scope){this.game=game,this.delay=delay,this.scope=scope,this.func=func,this.args=Array.prototype.slice.call(arguments,4),this.paused=!0,this.timer=null,this.init()},Timer.prototype={init:function(){var self=this;this.timer=setInterval(function(){self.paused||self.game.paused||self.func.apply(self.scope,self.args)},this.delay)},start:function(){this.paused=!1},stop:function(){this.paused=!0},destroy:function(){this.paused=!0,delete this.timer}},Controls=function(game){this.game=game,this.keyboard={z:null,enter:null,space:null,cursors:null},this.touch={a:null,left:null,right:null},this.input={a:!1,left:!1,right:!1},this.enabled=!1},Controls.prototype={create:function(){this.game.device.desktop?(console.log("keyboard"),this.keyboard.enter=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.keyboard.z=this.game.input.keyboard.addKey(Phaser.Keyboard.Z),this.keyboard.space=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.keyboard.cursors=this.game.input.keyboard.createCursorKeys()):(this.touch.a=this.game.add.sprite(924,520,"button_a"),this.touch.a.anchor.setTo(.5,.5),this.touch.a.alpha=.3,this.touch.a.fixedToCamera=!0,this.touch.left=this.game.add.button(100,520,"button_left"),this.touch.left.anchor.setTo(.5,.5),this.touch.left.alpha=.3,this.touch.left.fixedToCamera=!0,this.touch.right=this.game.add.button(255,520,"button_right",null,this,0,0,1),this.touch.right.anchor.setTo(.5,.5),this.touch.right.alpha=.3,this.touch.right.fixedToCamera=!0)},update:function(){this.enabled&&(this.game.device.desktop?(this.input.left=this.keyboard.cursors.left.isDown?!0:!1,this.input.right=this.keyboard.cursors.right.isDown?!0:!1,this.input.a=this.keyboard.enter.isDown||this.keyboard.z.isDown||this.keyboard.space.isDown||this.keyboard.cursors.up.isDown?!0:!1):(this.game.input.pointer1.isDown&&this.game.input.pointer1.position.x>874||this.game.input.pointer2.isDown&&this.game.input.pointer2.position.x>874?(this.touch.a.frame=1,this.input.a=!0):(this.touch.a.frame=0,this.input.a=!1),this.game.input.pointer1.isDown&&this.game.input.pointer1.position.x>150&&this.game.input.pointer1.position.x<300||this.game.input.pointer2.isDown&&this.game.input.pointer2.position.x>150&&this.game.input.pointer2.position.x<300?(this.input.right=!0,this.touch.right.frame=1):(this.input.right=!1,this.touch.right.frame=0),this.game.input.pointer1.isDown&&this.game.input.pointer1.position.x>0&&this.game.input.pointer1.position.x<150||this.game.input.pointer2.isDown&&this.game.input.pointer2.position.x>0&&this.game.input.pointer2.position.x<150?(this.input.left=!0,this.touch.left.frame=1):(this.input.left=!1,this.touch.left.frame=0)))},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},render:function(){1==debug&&(game.debug.text("pointer1: "+this.game.input.pointer1.position.x,850,90),game.debug.text("A: "+this.input.a,850,30),game.debug.text("Left: "+this.input.left,850,50),game.debug.text("Right: "+this.input.right,850,70))}};var StateBoot=function(){};StateBoot.prototype={preload:function(){game.load.image("loadbar1","assets/gui/loadbar_1.png"),game.load.image("loadbar2","assets/gui/loadbar_2.png"),game.load.image("bg","assets/gui/bg.png")},create:function(){this.stage.disableVisibilityChange=!0,this.game.device.desktop?(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.minWidth=416,this.scale.minHeight=260,this.scale.maxWidth=1024,this.scale.maxHeight=640,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setScreenSize(!0)):(this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.scale.setScreenSize(!0),this.scale.startFullScreen(!0)),game.state.start("loading")},gameResized:function(){},enterIncorrectOrientation:function(){BasicGame.orientated=!1,document.getElementById("orientation").style.display="block"},leaveIncorrectOrientation:function(){BasicGame.orientated=!0,document.getElementById("orientation").style.display="none"}};var StateLoading=function(game){this.game=game,this.enter=null,this.fade=60,this.bg=null};StateLoading.prototype={preload:function(){this.bg=game.add.tileSprite(0,0,game.world.width,game.world.height,"bg"),this.preloadBar1=game.add.sprite(172,320,"loadbar1"),this.preloadBar1.anchor.setTo(0,.5),this.preloadBar1.fixedToCamera=!0,this.preloadBar2=game.add.sprite(172,320,"loadbar2"),this.preloadBar2.anchor.setTo(0,.5),this.preloadBar2.cropEnabled,this.preloadBar2.fixedToCamera=!0,loadAssets()},loadUpdate:function(){this.preloadBar2.crop(new Phaser.Rectangle(0,0,this.game.load.progress/100*682,41))},create:function(){},update:function(){this.cache.isSoundDecoded("music")&&(this.ready=!0,game.state.start("start"),this.destroy())},destroy:function(){}};var StateStart=function(game){this.game=game,this.logo=null,this.menuSelected="start",this.cursors=null,this.gui={}};StateStart.prototype={preload:function(){this.background=new Background(game),this.controls=new Controls(game,"buttons")},create:function(){this.background.makeSky(),this.background.makeBackground(),this.background.fadeLoop(),this.logo=game.add.sprite(game.camera.width/2,240,"logo"),this.logo.anchor.setTo(.5,.5),this.logo.fixedToCamera=!0,this.startMenu=game.add.sprite(game.camera.width/2,500,"startOptions"),this.startMenu.anchor.setTo(.5,.5),this.startMenu.fixedToCamera=!0,this.music=this.add.audio("music",1,!0),this.music.play(),this.controls.create(),this.controls.enable()},update:function(){this.background.scroll(),this.controls.update(),this.controls.input.right?(this.startMenu.frame=1,this.menuSelected="hard"):this.controls.input.left&&(this.startMenu.frame=0,this.menuSelected="easy"),this.controls.input.a&&(hardMode="hard"==this.menuSelected?!0:!1,this.destroy(),game.state.start("game"))},destroy:function(){console.log(game.state.current+": destroyed"),this.music.stop()},render:function(){debug&&(game.time.advancedTiming=!0,game.debug.text("FPS: "+game.time.fps,850,10),this.controls.render())}};var StateGame=function(game){this.game=game,this.difficulty=0,this.hardMode=!1,this.spawnTimer=null,this.sectionManager=new SectionManager(["intro","start","mid","top","boss","outro"]),this.gui={}};StateGame.prototype={preload:function(){this.background=new Background(game),this.player=hardMode?new Player(game,1):new Player(game,40),this.platforms=new Platforms(game),this.bombs=new Bombs(game),this.shrooms=new Shrooms(game),this.controls=new Controls(game),this.boss=new Boss(game)},create:function(){this.game.world.setBounds(0,0,1024,4096),this.background.create(),this.bed=this.game.add.sprite(game.world.width/2,game.world.height-165,"bed"),this.bed.animations.add("sleep",[0,1,2,3,4],4,!0),this.bed.animations.add("awake",[5],1,!0),this.bed.animations.add("empty",[6],1,!0),this.bed.animations.play("sleep"),this.sign=this.game.add.sprite(100,game.world.height-135,"sign"),this.platforms.create(),this.platforms.generateBossArena(),this.bombs.create(),this.shrooms.create(),this.controls.create(),this.spawnTimer=new Timer(this.game,500,this.spawnEntity,this),this.gui.shroom=game.add.sprite(20,25,"shroom1"),this.gui.shroom.fixedToCamera=!0,this.gui.score=game.add.text(70,30,"x0",{font:"40px Arial",fill:"#ffffff",align:"left"}),this.gui.score.fixedToCamera=!0,this.gui.heart=game.add.sprite(160,30,"heart"),this.gui.heart.animations.add("beat",[0,1,2,3],10,!0),this.gui.heart.animations.play("beat"),this.gui.heart.fixedToCamera=!0,this.gui.health=game.add.text(200,30,"0",{font:"40px Arial",fill:"#ffffff",align:"left"}),this.gui.health.fixedToCamera=!0,this.music=this.add.audio("music",1,!0),this.music.play(),this.introInit()},update:function(){this.background.update(),this.bombs.update(),this.shrooms.update(),this.collisionChecks(),this.progressManager(),this.sectionManager.isRunning("start")&&(this.controlsUpdate(),this.platforms.removalCheck(),this.bombs.removalCheck(),this.shrooms.removalCheck()),this.sectionManager.isRunning("mid")&&(this.controlsUpdate(),this.platforms.removalCheck(),this.bombs.removalCheck(),this.shrooms.removalCheck()),this.sectionManager.isRunning("top")&&(this.controlsUpdate(),this.platforms.removalCheck(),this.bombs.removalCheck(),this.shrooms.removalCheck()),this.sectionManager.isRunning("boss")&&(this.boss.update(),this.controlsUpdate(),this.boss.sprite.heart<=0&&(this.sectionManager.isInitialised("outro")||(this.spawnTimer.stop(),this.sectionManager.init("outro"),console.log("running outro"),this.boss.deathOutro(),this.bombs.group.forEachAlive(this.bombs.explode,this.bombs),game.time.events.add(2*Phaser.Timer.SECOND,this.playerWin)))),this.sectionManager.isRunning("intro")||this.player.sprite.heart<=0&&(this.sectionManager.isInitialised("outro")||(this.sectionManager.init("outro"),this.player.death(),this.timer=this.game.time.create(!1),this.timer.start(),this.timer.add(4*Phaser.Timer.SECOND,this.playerLose))),this.difficulty=this.game.camera.y/this.game.world.height+.1,this.gui.score.text="x"+score,this.gui.health.text=this.player.sprite.heart},introInit:function(){for(i=0;6>i;i++)this.bombs.spawn(Math.random()*game.world.width,game.world.height-600);this.introTimer=this.game.time.create(!1),this.introTimer.start(),this.introTimer.add(3*Phaser.Timer.SECOND,this.startInit,this);var wakeUp=function(){this.bed.animations.play("awake")};this.wakeTimer=this.game.time.create(!1),this.wakeTimer.start(),this.wakeTimer.add(2*Phaser.Timer.SECOND,wakeUp,this),this.game.camera.y=game.world.height,this.sectionManager.init("intro")},startInit:function(){this.boss.create(),this.player.create(),this.bed.animations.play("empty"),this.game.camera.follow(this.player.sprite),this.game.camera.deadzone=new Phaser.Rectangle(50,this.game.camera.height/8*4,this.game.camera.width-100,this.game.camera.height/8*2),this.controls.enable(),this.sectionManager.start("start")},midInit:function(){this.spawnTimer.start()},topInit:function(){this.spawnTimer.stop()},bossInit:function(){this.spawnTimer.start(),this.game.camera.follow(null),game.add.tween(this.game.camera).to({y:0},500,Phaser.Easing.Linear.None).start()},controlsUpdate:function(){this.controls.update(),this.controls.input.a&&this.player.jump(),this.controls.input.left?this.player.move("left"):this.controls.input.right?this.player.move("right"):this.player.halt()},spawnEntity:function(){var x=0,y=0,velY=0;this.sectionManager.isRunning("boss")?(x=this.boss.sprite.x,y=this.boss.sprite.y,velY=-1e3):(x=Math.random()*game.world.width,y=this.player.sprite.y-600),Math.random()<this.difficulty?this.shrooms.spawn(x,y,velY):this.bombs.spawn(x,y,velY)},progressManager:function(){this.sectionManager.isRunning("start")&&this.game.camera.y<this.game.world.height-800&&(this.sectionManager.start("mid"),this.sectionManager.isInitialised("mid")||(this.sectionManager.init("mid"),this.midInit())),this.sectionManager.isRunning("mid")&&this.game.camera.y<700&&(this.sectionManager.start("top"),this.sectionManager.isInitialised("top")||(this.sectionManager.init("top"),this.topInit())),this.sectionManager.isRunning("top")&&this.game.camera.y<100&&(this.sectionManager.start("boss"),this.sectionManager.isInitialised("boss")||(this.sectionManager.init("boss"),this.bossInit()))},collisionChecks:function(){game.physics.arcade.overlap(this.player.sprite,this.platforms.group,this.player.fallDamage,null,this.player),game.physics.arcade.collide(this.player.sprite,this.platforms.group,this.platforms.age,this.player.platformCollision,this.player),game.physics.arcade.overlap(this.player.sprite,this.bombs.explosions,null,this.player.hurt,this.player),game.physics.arcade.overlap(this.player.sprite,this.shrooms.group,null,this.shrooms.collect,this.shrooms),game.physics.arcade.collide(this.platforms.group,this.bombs.group),game.physics.arcade.collide(this.platforms.group,this.shrooms.group),game.physics.arcade.collide(this.platforms.group,this.player.gibs),game.physics.arcade.collide(this.shrooms.group,this.bombs.group),game.physics.arcade.collide(this.bombs.group,this.bombs.group),game.physics.arcade.collide(this.shrooms.group,this.shrooms.group),game.physics.arcade.collide(this.player.sprite,this.boss.sprite,this.boss.playerBounce,this.boss.collisionCheck)},playerWin:function(){game.state.getCurrentState().destroy(),game.state.start("won")},playerLose:function(){game.state.getCurrentState().destroy(),game.state.start("lost")},render:function(){1==debug&&(Phaser.Time.advancedTiming=!0,game.debug.text("FPS: "+game.time.fps,850,30),game.debug.text("Diff: "+this.difficulty,850,50),game.debug.text("spawnTimer: "+this.spawnTimer.paused,850,70),game.debug.text("Section: "+this.sectionManager.currentSection(),850,90),game.debug.text("B: "+this.bombs.group.countLiving()+" | S: "+this.shrooms.group.countLiving(),850,120),this.platforms.group.forEachAlive(this.renderPhysics,this),this.bombs.group.forEachAlive(this.renderPhysics,this),this.bombs.explosions.forEachAlive(this.renderPhysics,this),this.sectionManager.isRunning("boss")&&(game.debug.body(this.boss.sprite),this.boss.render(),this.player.render()),this.sectionManager.isRunning("mid")&&(this.player.render(),game.debug.text("Health: "+this.player.sprite.heart,850,150)))},destroy:function(){this.sectionManager.resetAll(),this.spawnTimer.stop(),this.difficulty=0,this.music.stop()},renderPhysics:function(entity){game.debug.body(entity)}};var StateWon=function(game){this.game=game,this.gui={}};StateWon.prototype={preload:function(){this.background=new Background(game),this.controls=new Controls(game,"buttons")},create:function(){this.background.makeSky(),this.background.makeBackground(),this.background.fadeLoop(),this.logo=game.add.sprite(game.camera.width/2,240,"won"),this.logo.anchor.setTo(.5,.5),this.logo.fixedToCamera=!0,this.startMenu=game.add.sprite(game.camera.width/2,500,"return"),this.startMenu.anchor.setTo(.5,.5),this.startMenu.fixedToCamera=!0,this.startMenu.animations.add("flash",[0,1],.5,!0),this.startMenu.animations.play("flash"),this.gui.shroom=game.add.sprite(480,320,"shroom1"),this.gui.shroom.fixedToCamera=!0,this.gui.score=game.add.text(520,320,"x"+score,{font:"40px Arial",fill:"#ffffff",align:"left"}),this.controls.create(),this.controls.enable()},update:function(){this.background.scroll(),this.controls.update(),this.controls.input.a&&(this.destroy(),score=0,game.state.start("start"))},destroy:function(){console.log(game.state.current+": destroyed")},render:function(){debug&&(game.time.advancedTiming=!0,game.debug.text("FPS: "+game.time.fps,850,10),this.controls.render())}};var StateLost=function(game){this.game=game,this.logo=null,this.menuSelected="start",this.cursors=null,this.gui={}};StateLost.prototype={preload:function(){this.background=new Background(game),this.controls=new Controls(game,"buttons")},create:function(){this.background.makeSky(),this.background.makeBackground(),this.background.fadeLoop(),this.logo=game.add.sprite(game.camera.width/2,240,"died"),this.logo.anchor.setTo(.5,.5),this.logo.fixedToCamera=!0,this.startMenu=game.add.sprite(game.camera.width/2,500,"retryOptions"),this.startMenu.anchor.setTo(.5,.5),this.startMenu.fixedToCamera=!0,this.gui.shroom=game.add.sprite(480,320,"shroom1"),this.gui.shroom.fixedToCamera=!0,this.gui.score=game.add.text(520,320,"x"+score,{font:"40px Arial",fill:"#ffffff",align:"left"}),this.controls.create(),this.controls.enable()},update:function(){this.background.scroll(),this.controls.update(),this.controls.input.right?(this.startMenu.frame=1,this.menuSelected="start"):this.controls.input.left&&(this.startMenu.frame=0,this.menuSelected="retry"),this.controls.input.a&&("start"==this.menuSelected?(this.destroy(),game.state.start("start")):(this.destroy(),game.state.start("game")),score=0)},destroy:function(){console.log(game.state.current+": destroyed")},render:function(){debug&&(game.time.advancedTiming=!0,game.debug.text("FPS: "+game.time.fps,850,10),this.controls.render())}};var StateScores=function(){gameState="scores"};StateScores.prototype={preload:function(){},create:function(){},update:function(){}};var game=new Phaser.Game(1024,640,Phaser.CANVAS,"game_canvas"),score=0,hardMode=!1,music=null;game.state.add("boot",StateBoot,!1),game.state.add("loading",StateLoading,!1),game.state.add("start",StateStart,!1),game.state.add("game",StateGame,!1),game.state.add("lost",StateLost,!1),game.state.add("won",StateWon,!1),game.state.add("scores",StateScores,!1),game.state.start("boot");